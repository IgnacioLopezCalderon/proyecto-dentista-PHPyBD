{% extends "base.twig" %}

{% block titulo %}Mis Citas{% endblock %}

{% block estilos %}
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #555; font-size: 0.9rem; }

        .badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; color: white; }
        .pend { background: #f0ad4e; }
        .conf { background: #28a745; }
        .rech { background: #dc3545; }
        .fin { background: #007bff; }
    </style>
{% endblock %}

{% block contenido %}
    <div class="card card-wide">
        <h1>Mis Citas Médicas</h1>

        {% if citas is not empty %}
            <div style="overflow-x:auto;">
                <table>
                    <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Servicio</th>
                        <th>Estado</th>
                        <th>Acción</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for cita in citas %}
                        <tr>
                            <td>{{ cita.fecha_cita | date("d/m/Y") }}</td>
                            <td>{{ cita.fecha_cita | date("H:i") }}</td>
                            <td>{{ cita.servicios ? cita.servicios : 'Varios' }}</td>
                            <td>
                                {% if cita.nombre_estado == 'Pendiente' %}<span class="badge pend">Pendiente</span>{% endif %}
                                {% if cita.nombre_estado == 'Confirmada' %}<span class="badge conf">Confirmada</span>{% endif %}
                                {% if cita.nombre_estado == 'Rechazada' %}<span class="badge rech">Rechazada</span>{% endif %}
                                {% if cita.nombre_estado == 'Finalizada' %}<span class="badge fin">Finalizada</span>{% endif %}
                            </td>
                            <td>
                                {% if cita.nombre_estado == 'Pendiente' %}
                                    <form action="/citas/cancelar" method="POST" onsubmit="return confirm('¿Cancelar cita?');" style="margin:0;">
                                        <input type="hidden" name="id_cita" value="{{ cita.id_cita }}">
                                        <button type="submit" style="background:none; border:none; color:#dc3545; cursor:pointer; font-weight:bold;">
                                            ❌ Cancelar
                                        </button>
                                    </form>
                                {% else %}
                                    <span style="color:#ccc;">--</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="text-align:center; color:#777; font-style:italic;">No tienes citas registradas.</p>
        {% endif %}

        <div style="margin-top: 30px;">
            <a href="/citas/cliente" class="btn btn-gray" style="width:auto; display:inline-block; padding: 10px 30px;">⬅ Volver</a>
        </div>
    </div>
{% endblock %}